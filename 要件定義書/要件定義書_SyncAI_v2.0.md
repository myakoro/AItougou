# 要件定義書：AI統合回答アプリ（SyncAI）

**作成日**: 2025年12月19日  
**バージョン**: 2.0  
**ドキュメント種別**: 要件定義書

---

## 変更履歴

| バージョン | 日付 | 変更内容 |
|-----------|------|---------|
| 1.0 | 2025年12月16日 | 初版作成 |
| 2.0 | 2025年12月19日 | AI統合回答生成方式の変更、モデル選択機能追加 |

---

## 1. プロジェクト概要

### 1.1 プロジェクト名
AI統合回答アプリ（仮称：SyncAI）

### 1.2 目的・背景
ChatGPTは論理的な回答を生成する能力に優れているが、APIルールや規約などの情報が古く、実用的でない提案になることがある。一方、Perplexityは最新情報の取得に優れているが、論理的な分析が不十分な場合がある。本プロジェクトは、両者の強みを組み合わせ、最新情報に基づいた論理的な回答を得ることを目的とする。

### 1.3 想定ユーザー
- 本人（非エンジニア）
- 1名での単独利用

### 1.4 解決したい課題
- ChatGPTが古い情報（APIバージョン、ライブラリ仕様等）で回答する問題
- Perplexityの論理性の弱さ
- 最新情報と論理性を両立した回答を1つのアプリで得たい

**具体例：**
「ChatGPT APIバージョン5.2の実装方法」と質問した際、ChatGPTは「4.0が最新」と誤回答するが、Perplexityで調査すると5.2が実際に使用可能だった。

---

## 2. v2.0での変更内容

### 2.1 主な変更点

| 変更項目 | v1.0 | v2.0 |
|---------|------|------|
| AI統合方式 | ChatGPT → Perplexity → ChatGPT統合（常に3回） | 質問分類 → 条件付きPerplexity調査（1-3回） |
| モデル選択 | なし | ChatGPTモデルを4つから選択可能 |
| 処理時間 | 常に15秒 | 3-5秒（TYPE_A）、10-15秒（TYPE_B） |
| モデル更新 | なし | GitHubから自動更新 |

### 2.2 v2.0の改善効果
- ChatGPTの古い情報での回答を防止
- Perplexityの最新情報を優先的に活用
- 不要なAPI呼び出しを削減
- 処理時間とコストの最適化

---

## 3. スコープ定義

### 3.1 v2.0で実現する機能

**v1.0からの継承機能：**
- 質問入力機能
- 統合回答の表示
- スレッド管理（作成・切り替え・削除・編集）
- APIキーの設定
- エラー通知
- 処理状況表示

**v2.0の新機能：**
- 質問の自動分類（TYPE_A：普遍的知識 / TYPE_B：時間依存知識）
- 適応的AI統合回答生成
- ChatGPTモデル選択（4モデルから選択）
- モデルリスト自動更新（GitHubから取得）

### 3.2 将来検討する機能
- Claude、Gemini等の他AIサービス連携
- スマートフォン対応
- スレッドのエクスポート/インポート
- 回答の評価機能
- よく使う質問のテンプレート

### 3.3 対象外の機能
- ユーザー認証・ログイン
- 複数ユーザーでのデータ共有
- クラウド同期
- 音声入出力
- 画像添付

---

## 4. 機能要件

### 4.1 機能一覧

| 機能ID | 機能名 | 概要 | 優先度 | v2.0での変更 |
|--------|--------|------|--------|-------------|
| F001 | 質問入力 | ユーザーが質問を入力して送信 | 必須 | なし |
| F002 | AI統合回答生成 | 質問を分類し、適応的にChatGPTとPerplexityを活用 | 必須 | **大幅変更** |
| F003 | 回答表示 | 統合回答を表示、詳細も確認可能 | 必須 | 軽微な変更 |
| F004 | スレッド管理 | スレッドの作成・切り替え・削除・編集 | 必須 | なし |
| F005 | API設定 | APIキー設定、モデル選択 | 必須 | **機能追加** |
| F006 | エラー通知 | エラー発生時の通知 | 必須 | なし |
| F007 | 処理状況表示 | 処理状況の通知 | 重要 | 表示内容変更 |
| F009 | モデルリスト自動更新 | GitHubから最新モデルリストを取得 | 重要 | **新規** |

---

### 4.2 F002: AI統合回答生成（v2.0の核心機能）

#### 4.2.1 処理フロー概要

```
ユーザー質問
   ↓
ステップ1：質問分類（ChatGPT）
   ├→ TYPE_A（普遍的知識）→ ChatGPT回答生成 → 表示
   └→ TYPE_B（時間依存知識）
       ↓
   ステップ2：確認項目抽出（ChatGPT）
       ↓
   ステップ3：最新情報調査（Perplexity）
       ↓
   ステップ4：最終回答生成（ChatGPT）
       ↓
   表示
```

#### 4.2.2 質問分類の基準

**TYPE_A（普遍的知識）：**
- プログラミング言語の基本構文
- 数学的原理、アルゴリズム
- 確立された技術概念

**例：**
- Pythonでリストを降順ソートする方法
- オブジェクト指向とは
- 二分探索の計算量

**TYPE_B（時間依存知識）：**
- 特定のAPI、ライブラリ、フレームワークの使い方
- 公式ドキュメント、規約
- 最新バージョン、機能

**例：**
- ChatGPT API 5.2の実装方法
- React 19の新機能
- OpenAI APIの料金体系

#### 4.2.3 各ステップの役割

**ステップ1：質問分類**
- ChatGPTが質問をTYPE_A/TYPE_Bに分類
- 処理時間：1-2秒

**ステップ2：確認項目抽出（TYPE_Bのみ）**
- ChatGPTが「最新情報確認が必要な項目」をリストアップ
- 例：最新バージョン、料金体系、認証方法、etc.
- 処理時間：1-2秒

**ステップ3：最新情報調査（TYPE_Bのみ）**
- Perplexityが公式情報を優先して調査
- 情報源URLを必ず取得
- 処理時間：3-5秒

**ステップ4：最終回答生成（TYPE_Bのみ）**
- ChatGPTがPerplexityの最新情報を基に論理的な回答を生成
- Perplexityの情報を「今日確認した事実」として扱う
- 処理時間：3-5秒

#### 4.2.4 処理時間

| 質問タイプ | API呼び出し回数 | 処理時間 |
|-----------|----------------|---------|
| TYPE_A | 2回 | 3-5秒 |
| TYPE_B | 4回 | 10-15秒 |

---

### 4.3 F005: API設定（v2.0で機能追加）

#### 4.3.1 設定項目

| 項目名 | 説明 | v2.0での変更 |
|--------|------|-------------|
| ChatGPT APIキー | ChatGPT API利用のための認証キー | なし |
| Perplexity APIキー | Perplexity API利用のための認証キー | なし |
| ChatGPT使用モデル | 使用するChatGPTモデル（4つから選択） | **新規追加** |

#### 4.3.2 選択可能なChatGPTモデル

| モデルID | 表示名 | 用途 | デフォルト |
|---------|--------|------|-----------|
| gpt-5.2 | GPT-5.2（最新・推奨） | 最高性能、高度な推論 | ● |
| gpt-5 | GPT-5（標準） | 汎用タスク、バランス型 | |
| gpt-5-mini | GPT-5-mini（軽量） | 低コスト、高速 | |
| gpt-5-nano | GPT-5-nano（超軽量） | 大量処理、最小コスト | |

---

### 4.4 F009: モデルリスト自動更新（v2.0新規）

#### 4.4.1 機能概要
アプリ起動時にGitHubから最新のモデルリストを自動ダウンロードし、設定画面の選択肢を更新する。

#### 4.4.2 動作仕様
- **トリガー**: アプリ起動時
- **取得先**: GitHub公開リポジトリの`models.json`
- **タイムアウト**: 5秒
- **成功時**: 最新リストを使用、ローカルに保存
- **失敗時**: 前回保存したローカルファイルを使用（エラー非表示）

#### 4.4.3 運用方法
1. 開発者がGitHubで`models.json`を編集
2. GitHubにプッシュ
3. ユーザーは次回アプリ起動時に自動的に最新リストを取得
4. ユーザー側の操作は一切不要

---

## 5. 非機能要件

### 5.1 パフォーマンス

| 項目 | 要件 |
|------|------|
| AI統合回答生成（TYPE_A） | 3-5秒以内 |
| AI統合回答生成（TYPE_B） | 10-15秒以内 |
| スレッド切り替え | 1秒以内 |
| アプリ起動 | 3秒以内 |

### 5.2 セキュリティ

| 項目 | 要件 |
|------|------|
| APIキーの保護 | 暗号化して保存 |
| APIキーの表示 | マスク表示（●●●） |
| データ保存 | ローカルのみ、外部送信なし |

### 5.3 可用性・信頼性

| 項目 | 要件 |
|------|------|
| オフライン動作 | API呼び出し以外は動作不要 |
| エラー復旧 | 分かりやすいメッセージで再試行を促す |
| モデルリスト更新失敗時 | 前回保存ファイルで透過的に動作 |

### 5.4 ユーザビリティ

| 項目 | 要件 |
|------|------|
| UI | 非エンジニアでも迷わないシンプルなデザイン |
| 処理状況 | API呼び出し中は状況を表示 |
| エラーメッセージ | 技術用語を避け、次のアクションを明示 |

---

## 6. データ要件

### 6.1 保存するデータ

| データ種別 | 内容 | 保存場所 |
|-----------|------|---------|
| スレッド | 会話のまとまり | ローカルDB |
| メッセージ | 質問と回答 | ローカルDB |
| API設定 | APIキー、使用モデル | ローカル（暗号化） |
| モデルリスト | 選択可能なモデル情報 | ローカルJSON |

### 6.2 メッセージに保存する情報（v2.0で追加）

| 項目名 | 説明 | TYPE_A | TYPE_B |
|--------|------|--------|--------|
| 質問内容 | ユーザーの質問 | ● | ● |
| 統合回答 | 最終的な回答 | ● | ● |
| 質問タイプ | TYPE_AまたはTYPE_B | ● | ● |
| 確認項目リスト | ChatGPTが抽出した項目 | - | ● |
| Perplexity調査結果 | 最新情報と情報源URL | - | ● |

---

## 7. 制約条件・前提条件

### 7.1 技術的制約

| 項目 | 制約 |
|------|------|
| 対応OS | Windows 11以降 |
| インターネット接続 | 必須（API呼び出しのため） |
| 必要なAPI | ChatGPT API、Perplexity API |
| GitHubアクセス | 起動時に必要（タイムアウト5秒） |

### 7.2 開発制約

| 項目 | 制約 |
|------|------|
| 開発期間 | 1-2週間 |
| 開発ツール | Google Bolt（Antigravity）またはWindsurf |
| 開発コスト | 無料ツール使用 |

### 7.3 その他

| 項目 | 内容 |
|------|------|
| API利用料金 | ユーザー（本人）が負担 |
| ユーザー数 | 1人（本人のみ） |

---

## 8. 用語集

| 用語 | 説明 |
|------|------|
| スレッド | 一連の会話のまとまり |
| 統合回答 | ChatGPTとPerplexityの情報を基に生成された最終回答 |
| TYPE_A | 時間に依存しない普遍的な知識 |
| TYPE_B | 時間に依存する可能性がある知識 |
| 質問分類 | 質問をTYPE_AまたはTYPE_Bに自動判定するプロセス |
| 確認項目 | ChatGPTが抽出した、最新情報確認が必要な項目のリスト |
| models.json | ChatGPTモデルの選択肢を定義した設定ファイル |

---

## 9. 成果物

本要件定義書に基づき、以下の設計書を作成すること：

1. **基本設計書**：システム構成、画面設計、データベース設計
2. **詳細設計書**：各処理の詳細フロー、プロンプト設計、エラーハンドリング

---

## 10. 承認

| 役割 | 氏名 | 日付 | 署名 |
|------|------|------|------|
| 要件定義責任者 | | | |
| プロジェクトオーナー | | | |

