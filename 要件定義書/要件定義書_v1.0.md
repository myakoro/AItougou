# 要件定義書：AI統合回答アプリ（SyncAI）

**作成日**: 2025年12月16日  
**バージョン**: 1.0  
**ドキュメント種別**: 要件定義書

---

## 1. プロジェクト概要

### 1.1 プロジェクト名
AI統合回答アプリ（仮称：SyncAI）

### 1.2 目的・背景
ChatGPTは論理的な回答を生成する能力に優れているが、APIルールや規約などの情報が古く、実用的でない提案になることがある。一方、Perplexityは最新情報の取得に優れているが、論理的な分析が不十分な場合がある。本プロジェクトは、両者の強みを組み合わせ、最新情報に基づいた論理的な回答を得ることを目的とする。

### 1.3 想定ユーザー/プレイヤー
- 本人（非エンジニア）
- 1名での単独利用

### 1.4 開発の動機・解決したい課題
- ビジネス調査やアプリ開発時に、情報鮮度の高い論理的な回答が必要
- AIエージェントが古い情報（一昔前のAPIルールや規約）で提案してくる問題を解決したい
- 特定のサイトのAPIルールや規約について、最新かつ正確な情報を得たい
- 論理性と情報鮮度の両方を兼ね備えた回答を1つのアプリで得たい

---

## 2. スコープ定義

### 2.1 v1.0で実現する機能（In Scope）
- 質問入力機能
- ChatGPT APIへの問い合わせ
- Perplexity APIへの問い合わせ
- 2つの回答を分析した統合回答の生成
- 統合回答の表示
- 元の2つの回答の表示（折りたたみ形式で確認可能）
- スレッド形式での会話管理
- スレッドの新規作成
- スレッドの切り替え
- スレッドの削除
- スレッド名の編集
- APIキーの設定・保存
- APIキーの変更
- エラー発生時の通知
- 処理状況の表示

### 2.2 将来検討する機能（Future Scope）
- Claude、Geminiなど他のAIサービスとの連携
- スマートフォン（Android）対応
- スレッドのエクスポート機能
- スレッドのインポート機能
- 回答の評価機能
- よく使う質問のテンプレート機能

### 2.3 対象外の機能（Out of Scope）
- ユーザー認証機能
- ログイン機能
- 複数ユーザーでのデータ共有
- クラウドへのデータ同期
- チーム・組織での利用機能
- 音声入力機能
- 音声出力機能
- 画像添付機能

---

## 3. 機能要件

### 3.1 コア機能一覧

| 機能ID | 機能名 | 概要 | 優先度 |
|--------|--------|------|--------|
| F001 | 質問入力 | ユーザーが質問を入力してシステムに送信 | 必須 |
| F002 | AI統合回答生成 | ChatGPTとPerplexityから回答を取得し統合 | 必須 |
| F003 | 回答表示 | 統合回答を表示、元の回答も確認可能 | 必須 |
| F004 | スレッド管理 | スレッドの作成・切り替え・削除・編集 | 必須 |
| F005 | API設定 | APIキーの登録・保存・変更 | 必須 |
| F006 | エラー通知 | エラー発生時の適切な通知 | 必須 |
| F007 | 処理状況表示 | 現在の処理状況の通知 | 重要 |

---

### 3.2 機能詳細

#### F001: 質問入力

- **機能ID**: F001
- **機能名**: 質問入力
- **機能概要**: ユーザーがテキストで質問を入力し、システムに送信する
- **トリガー**: 質問入力欄に文字を入力し、送信ボタンをクリック（またはEnterキー押下）
- **前提条件**: APIキーが設定済みであること

**具体的な動作・振る舞い（正常系）**:
1. ユーザーが質問入力欄に質問を入力する
2. 送信ボタンをクリックまたはEnterキーを押下する
3. 質問が現在のスレッドに追加される
4. AI統合回答生成処理が開始される

**異常系の動作**:
- 質問が空白の場合：送信ボタンが無効化され、送信できない
- APIキーが未設定の場合：「APIキーを設定してください」とメッセージを表示し、設定画面へ誘導する

**入力項目**:
| 項目名 | 型 | 必須/任意 | 制約 |
|--------|-----|----------|------|
| 質問テキスト | 文字列 | 必須 | 最大10,000文字 |

**出力項目**:
- なし（内部処理へ引き継ぎ）

**エラーメッセージ・バリデーションルール**:
- 空白チェック：質問が空の場合は送信不可
- 文字数チェック：10,000文字を超える場合は入力不可
- APIキー未設定時：「APIキーを設定してください」

**関連する画面・機能**: メイン画面

**優先度**: 必須

---

#### F002: AI統合回答生成

- **機能ID**: F002
- **機能名**: AI統合回答生成
- **機能概要**: ChatGPTとPerplexityに問い合わせを行い、2つの回答を分析した統合回答を生成する
- **トリガー**: F001で質問が送信された時
- **前提条件**: 
  - APIキーが設定済みであること
  - ネットワーク接続が有効であること

**具体的な動作・振る舞い（正常系）**:
1. ユーザーの質問をChatGPTとPerplexityに送信する（会話の文脈も含める）
2. ChatGPTから回答Aを取得する
3. Perplexityから回答Bを取得する
4. ChatGPTに以下の指示で統合回答を生成させる：
   - 「回答AとBを分析してください」
   - 「Perplexityの最新情報を優先してください」
   - 「論理的で実用的な統合回答を生成してください」
5. 統合回答Cを取得する
6. 3つの回答（A, B, C）をスレッドに保存する
7. 統合回答Cを画面に表示する

**異常系の動作**:
- ChatGPTのみエラーが発生した場合：
  - メッセージ：「ChatGPTからの応答取得に失敗しました。処理を中断します。」
  - 処理を中断する
  
- Perplexityのみエラーが発生した場合：
  - メッセージ：「Perplexityからの応答取得に失敗しました。処理を中断します。」
  - 処理を中断する
  
- 両方のAPIがエラーを返した場合：
  - メッセージ：「ChatGPTとPerplexityの両方からの応答取得に失敗しました。ネットワーク接続とAPIキーを確認してください。」
  - 処理を中断する
  
- API呼び出し回数制限に達した場合：
  - メッセージ：「APIの呼び出し回数制限に達しましたので中断します。」
  - 処理を中断する
  
- 応答時間が15秒を超えた場合：
  - メッセージ：「応答時間が長すぎます。処理を中断します。」
  - 処理を中断する

**入力項目**:
| 項目名 | 型 | 必須/任意 | 制約 |
|--------|-----|----------|------|
| 質問内容 | 文字列 | 必須 | 最大10,000文字 |
| 会話履歴 | 配列 | 任意 | 同一スレッド内の過去の質問と回答 |

**出力項目**:
| 項目名 | 型 | 説明 |
|--------|-----|------|
| 統合回答 | 文字列 | 最新情報と論理性を兼ね備えた最終回答 |
| ChatGPT単体回答 | 文字列 | ChatGPTから取得した回答 |
| Perplexity単体回答 | 文字列 | Perplexityから取得した回答 |

**エラーメッセージ・バリデーションルール**:
- 上記の異常系の動作を参照

**関連する画面・機能**: メイン画面

**制約条件・ビジネスルール**:
- 処理時間は15秒以内に完了すること
- 会話履歴を含める場合、量が多すぎないよう調整すること
- 統合回答生成時は、Perplexityの最新情報を優先すること

**優先度**: 必須

**補足・設計への引き継ぎ事項**:
- ChatGPTとPerplexityへの問い合わせは可能な限り高速化すること
- 統合回答生成のプロンプトはPerplexityの最新情報を優先しつつ、ChatGPTの論理性を活かす内容にすること
- 会話履歴の送信量はAPIのトークン制限を考慮すること

---

#### F003: 回答表示

- **機能ID**: F003
- **機能名**: 回答表示
- **機能概要**: 統合回答をメインに表示し、元の2つの回答は折りたたみ形式で確認できるようにする
- **トリガー**: F002で統合回答が生成された時
- **前提条件**: 統合回答が正常に生成されていること

**具体的な動作・振る舞い（正常系）**:
1. 統合回答を会話エリアに表示する
2. 統合回答の下に「詳細を見る」ボタンを表示する
3. 「詳細を見る」ボタンをクリックすると、以下を展開表示する：
   - ChatGPT単体の回答（セクション見出し付き）
   - Perplexity単体の回答（セクション見出し付き）
4. 「詳細を見る」ボタンを再度クリックすると折りたたむ

**異常系の動作**:
- なし（F002でエラーが発生した場合、本機能は実行されない）

**入力項目**:
- なし（F002の出力を受け取る）

**出力項目**:
| 項目名 | 型 | 表示形式 |
|--------|-----|----------|
| 統合回答 | 文字列 | 通常表示（強調） |
| ChatGPT単体回答 | 文字列 | 折りたたみ表示 |
| Perplexity単体回答 | 文字列 | 折りたたみ表示 |

**関連する画面・機能**: メイン画面

**優先度**: 必須

**補足・設計への引き継ぎ事項**:
- 統合回答は視覚的に強調表示し、ユーザーが最も注目すべき情報であることを明確にすること
- 折りたたみの開閉は分かりやすく、操作しやすいこと

---

#### F004: スレッド管理

- **機能ID**: F004
- **機能名**: スレッド管理
- **機能概要**: 会話をスレッド単位で管理し、複数のスレッドを作成・切り替え・削除・編集できる
- **トリガー**: ユーザーがスレッド操作を実行した時
- **前提条件**: なし

**具体的な動作・振る舞い（正常系）**:

##### 4.1 新規スレッド作成
1. ユーザーが「新規スレッド」ボタンをクリックする
2. 新しい空のスレッドが作成される
3. スレッド名は「新しい会話」として自動設定される
4. 新しいスレッドが選択状態になる
5. 最初の質問送信後、質問内容からスレッド名を自動生成する（最大30文字）

##### 4.2 スレッド切り替え
1. ユーザーがスレッド一覧から目的のスレッドをクリックする
2. 該当スレッドの会話履歴が画面に表示される
3. 会話の続きが可能になる

##### 4.3 スレッド削除
1. ユーザーがスレッド一覧で削除したいスレッドの削除アイコンをクリックする
2. 確認ダイアログ「このスレッドを削除しますか？」を表示する
3. ユーザーが「削除」をクリックすると削除実行する
4. ユーザーが「キャンセル」をクリックすると削除を中止する
5. 削除されたスレッドは完全に削除され、復元できない

##### 4.4 スレッド名編集
1. ユーザーがスレッド一覧でスレッド名をダブルクリックする
2. 編集モードに切り替わる
3. ユーザーが新しい名前を入力する
4. Enterキーを押下すると確定する
5. Escキーを押下すると編集をキャンセルする

**異常系の動作**:
- スレッド名を空白にした場合：元の名前に戻る
- スレッドが1つもない場合：自動的に新規スレッドを作成する
- 削除しようとしたスレッドが最後の1つの場合：削除後、自動的に新規スレッドを作成する

**入力項目**:
| 項目名 | 型 | 必須/任意 | 制約 |
|--------|-----|----------|------|
| スレッド名（編集時） | 文字列 | 必須 | 最大50文字 |

**出力項目**:
- なし（画面表示のみ）

**エラーメッセージ・バリデーションルール**:
- スレッド名の空白チェック：空白の場合は元の名前に戻す
- スレッド名の文字数チェック：50文字を超える場合は入力不可

**関連する画面・機能**: メイン画面

**制約条件・ビジネスルール**:
- スレッドは削除するまで永久保存される
- スレッド一覧は更新日時の降順（新しい順）で表示される

**優先度**: 必須

**補足・設計への引き継ぎ事項**:
- スレッド名の自動生成は、質問内容の要約または最初の30文字程度を使用すること

---

#### F005: API設定

- **機能ID**: F005
- **機能名**: API設定
- **機能概要**: ChatGPTとPerplexityのAPIキーを登録・保存・変更する
- **トリガー**: 
  - 初回起動時（APIキー未設定の場合）
  - ユーザーが設定画面を開いた時
- **前提条件**: なし

**具体的な動作・振る舞い（正常系）**:
1. ユーザーが設定画面を開く
2. ChatGPT APIキー入力欄とPerplexity APIキー入力欄が表示される
3. ユーザーが各APIキーを入力する
4. ユーザーが「保存」ボタンをクリックする
5. APIキーが保存される
6. 「設定を保存しました」とメッセージを表示する
7. 設定画面を閉じる

**異常系の動作**:
- APIキーが空白の場合：
  - メッセージ：「APIキーを入力してください」
  - 保存処理を実行しない
  
- 保存処理が失敗した場合：
  - メッセージ：「設定の保存に失敗しました」

**入力項目**:
| 項目名 | 型 | 必須/任意 | 制約 |
|--------|-----|----------|------|
| ChatGPT APIキー | 文字列 | 必須 | 半角英数字、最大200文字 |
| Perplexity APIキー | 文字列 | 必須 | 半角英数字、最大200文字 |

**出力項目**:
- なし（内部保存のみ）

**エラーメッセージ・バリデーションルール**:
- 空白チェック：「APIキーを入力してください」
- 文字種チェック：半角英数字のみ
- 文字数チェック：最大200文字

**関連する画面・機能**: 設定画面

**制約条件・ビジネスルール**:
- APIキーは安全に保存されること
- APIキーは後から変更・再設定可能であること
- 設定画面ではAPIキーをマスク表示（●●●）すること

**優先度**: 必須

**補足・設計への引き継ぎ事項**:
- APIキーは平文で保存せず、適切に保護すること

---

#### F006: エラー通知

- **機能ID**: F006
- **機能名**: エラー通知
- **機能概要**: システムエラーやAPI呼び出しエラーを適切にユーザーに通知する
- **トリガー**: エラー発生時
- **前提条件**: なし

**エラー種別と表示内容**:

| エラー種別 | 表示メッセージ | 補足説明 | ユーザーの次のアクション |
|------------|----------------|----------|--------------------------|
| ChatGPT APIエラー | ChatGPTからの応答取得に失敗しました。処理を中断します。 | APIキーとネットワーク接続を確認してください | APIキー確認、ネットワーク確認 |
| Perplexity APIエラー | Perplexityからの応答取得に失敗しました。処理を中断します。 | APIキーとネットワーク接続を確認してください | APIキー確認、ネットワーク確認 |
| 両APIエラー | ChatGPTとPerplexityの両方からの応答取得に失敗しました。 | ネットワーク接続とAPIキーを確認してください | APIキー確認、ネットワーク確認 |
| API呼び出し回数制限 | APIの呼び出し回数制限に達しましたので中断します。 | しばらく待ってから再度お試しください | 時間をおいて再試行 |
| タイムアウト | 応答時間が長すぎます。処理を中断します。 | ネットワーク接続を確認してください | ネットワーク確認 |
| ネットワークエラー | ネットワーク接続に失敗しました。 | インターネット接続を確認してください | ネットワーク確認 |
| APIキー未設定 | APIキーを設定してください | 設定画面からAPIキーを登録してください | 設定画面を開く |

**具体的な動作・振る舞い（正常系）**:
1. エラーが発生する
2. エラー種別を判定する
3. 適切なエラーメッセージを画面に表示する
4. 必要に応じて補足説明を表示する

**異常系の動作**:
- なし（エラー通知自体がエラー処理のため）

**関連する画面・機能**: すべての画面

**制約条件・ビジネスルール**:
- エラーメッセージは分かりやすく、ユーザーが次に何をすべきか明確にすること
- 技術的な専門用語は避け、非エンジニアでも理解できる表現にすること

**優先度**: 必須

---

#### F007: 処理状況表示

- **機能ID**: F007
- **機能名**: 処理状況表示
- **機能概要**: API呼び出し中の処理状況をユーザーに通知し、システムが動作中であることを示す
- **トリガー**: F002の処理中
- **前提条件**: なし

**具体的な動作・振る舞い（正常系）**:
1. 質問送信後、処理状況の表示を開始する
2. 以下の順で状況を更新する：
   - 「ChatGPTに問い合わせ中...」
   - 「Perplexityに問い合わせ中...」
   - 「回答を統合中...」
3. 処理完了後、表示を消去する

**異常系の動作**:
- エラー発生時：処理状況表示を消去し、エラーメッセージを表示する

**入力項目**:
- なし

**出力項目**:
| 項目名 | 型 | 表示形式 |
|--------|-----|----------|
| 処理状況テキスト | 文字列 | テキスト表示 |

**関連する画面・機能**: メイン画面

**制約条件・ビジネスルール**:
- 処理状況は目立ちすぎず、かつ確認しやすい位置に表示すること
- ユーザーがシステムがフリーズしていないことを確認できること

**優先度**: 重要（必須ではないが、UX向上のため実装推奨）

---

## 4. 非機能要件

### 4.1 パフォーマンス要件

| 項目 | 要件 | 測定方法 |
|------|------|----------|
| AI統合回答生成時間 | 15秒以内に完了すること | 質問送信から統合回答表示までの時間を計測 |
| アプリケーション起動時間 | 起動から操作可能になるまで3秒以内 | アプリ起動から質問入力可能になるまでの時間を計測 |
| 画面遷移時間 | スレッド切り替え時は1秒以内に表示完了 | スレッドクリックから会話履歴表示までの時間を計測 |

### 4.2 使いやすさ（UI/UX）要件

| 項目 | 要件 |
|------|------|
| 直感的な操作 | プログラミング知識がなくても使えること |
| エラー時のフィードバック | エラー発生時は原因と対処方法を明示すること |
| 学習コスト | 初めて使う人が5分以内に基本操作を理解できること |
| 視認性 | 文字サイズは読みやすく、色使いは目に優しいこと |
| 操作の一貫性 | 似た操作は同じ方法で実行できること |

### 4.3 互換性・動作環境

| 項目 | 要件 |
|------|------|
| 対応OS | Windows 11以降 |
| 必要スペック | CPU: Intel Core i3以上、メモリ: 4GB以上、ストレージ: 100MB以上の空き容量 |
| ネットワーク | インターネット接続必須 |
| 画面解像度 | 最小1280×720以上 |

### 4.4 可用性・信頼性

| 項目 | 要件 |
|------|------|
| 稼働時間 | ユーザーが使用したい時にいつでも起動・使用可能であること |
| データ損失 | スレッドデータは適切に保存され、アプリ終了後も保持されること |
| 障害発生時の対応 | エラー発生時は適切に通知し、データ損失を最小限にすること |
| データ整合性 | 保存されたデータは破損せず、正常に読み込めること |

### 4.5 セキュリティ要件

| 項目 | 要件 |
|------|------|
| APIキーの保護 | APIキーは安全に保存され、第三者が容易に取得できないこと |
| 通信の暗号化 | API通信は暗号化された経路で行われること |
| データの保護 | スレッドデータは本人以外がアクセスできないよう保護されること |
| 機密情報の表示 | 設定画面ではAPIキーをマスク表示すること |

### 4.6 保守性・拡張性

| 項目 | 要件 |
|------|------|
| エラーログ | エラー発生時は詳細情報をログファイルに記録すること |
| 将来の機能拡張 | 他のAIサービス（Claude、Gemini）を追加しやすい設計とすること |
| バージョン管理 | アプリケーションのバージョン情報を確認できること |
| 設定のバックアップ | ユーザーが設定やデータをバックアップできること |

---

## 5. UI/UX要件

### 5.1 画面一覧

| 画面ID | 画面名 | 目的 | 遷移元 |
|--------|--------|------|--------|
| S001 | メイン画面 | 質問入力、回答表示、スレッド管理 | 起動時の初期画面 |
| S002 | 設定画面 | APIキーの設定・変更 | メイン画面の設定ボタン |

### 5.2 画面詳細

#### S001: メイン画面

**画面の目的**:
- 質問を入力してAIに問い合わせる
- 統合回答と元の回答を確認する
- スレッドを管理する（作成、切り替え、削除、編集）

**表示項目**:
| 項目名 | 説明 | 必須/任意 |
|--------|------|----------|
| スレッド一覧 | 作成済みスレッドの一覧を表示 | 必須 |
| スレッド名 | 現在選択中のスレッド名 | 必須 |
| 会話履歴エリア | 質問と回答を時系列で表示 | 必須 |
| 質問入力欄 | 質問を入力するテキストエリア | 必須 |
| 送信ボタン | 質問を送信するボタン | 必須 |
| 新規スレッドボタン | 新しいスレッドを作成するボタン | 必須 |
| 設定ボタン | 設定画面を開くボタン | 必須 |
| 処理状況表示 | 現在の処理状況を表示するエリア | 重要 |

**入力項目**:
| 項目名 | 型 | 必須/任意 | 制約 | バリデーション |
|--------|-----|----------|------|----------------|
| 質問テキスト | 文字列 | 必須 | 最大10,000文字 | 空白不可、文字数制限 |

**ボタン・操作要素**:
| 名称 | 動作 | 遷移先 |
|------|------|--------|
| 送信ボタン | 質問を送信してAI統合回答生成を開始 | なし（同一画面） |
| 新規スレッドボタン | 新しいスレッドを作成 | なし（同一画面） |
| 設定ボタン | 設定画面を開く | S002（設定画面） |
| スレッド選択 | クリックでスレッドを切り替え | なし（同一画面） |
| スレッド削除アイコン | スレッドを削除 | なし（同一画面） |
| スレッド名（ダブルクリック） | スレッド名を編集 | なし（同一画面） |
| 詳細を見るボタン | 元の2つの回答を表示/非表示 | なし（同一画面） |

**エラーメッセージの表示方法**:
- 画面上部または会話エリア内に表示
- エラーメッセージの下に対処方法を記載
- 視覚的に分かりやすく表示（色、アイコンなど）

**画面レイアウトの方向性**:
- 左側：スレッド一覧（サイドバー形式）
- 右側：メインエリア（会話履歴、質問入力）
- 上部：設定ボタン、新規スレッドボタン
- 下部：質問入力欄と送信ボタン

---

#### S002: 設定画面

**画面の目的**:
- ChatGPTとPerplexityのAPIキーを設定・変更する

**表示項目**:
| 項目名 | 説明 | 必須/任意 |
|--------|------|----------|
| ChatGPT APIキー入力欄 | ChatGPT APIキーを入力 | 必須 |
| Perplexity APIキー入力欄 | Perplexity APIキーを入力 | 必須 |
| 保存ボタン | 設定を保存するボタン | 必須 |
| キャンセルボタン | 設定を保存せず閉じるボタン | 必須 |

**入力項目**:
| 項目名 | 型 | 必須/任意 | 制約 | バリデーション |
|--------|-----|----------|------|----------------|
| ChatGPT APIキー | 文字列 | 必須 | 半角英数字、最大200文字 | 空白不可、文字種チェック、文字数制限 |
| Perplexity APIキー | 文字列 | 必須 | 半角英数字、最大200文字 | 空白不可、文字種チェック、文字数制限 |

**ボタン・操作要素**:
| 名称 | 動作 | 遷移先 |
|------|------|--------|
| 保存ボタン | APIキーを保存して設定画面を閉じる | S001（メイン画面） |
| キャンセルボタン | 保存せずに設定画面を閉じる | S001（メイン画面） |

**エラーメッセージの表示方法**:
- 入力欄の下に表示
- 視覚的に分かりやすく表示（色、アイコンなど）

**画面レイアウトの方向性**:
- 中央にモーダル形式で表示
- シンプルで分かりやすいレイアウト

---

### 5.3 操作性要件

**主要な操作フロー**:
1. アプリ起動 → 初回の場合は設定画面でAPIキー設定 → メイン画面表示
2. 質問入力 → 送信 → AI統合回答表示 → 必要に応じて詳細確認
3. 追加質問 → 送信 → AI統合回答表示（会話の文脈を保持）
4. 新しい話題の場合 → 新規スレッド作成 → 質問入力

**キーボード操作・ショートカット要件**:
- Enterキー：質問を送信
- Escキー：編集モードをキャンセル

**レスポンシブ対応要件**:
- v1.0ではWindowsデスクトップアプリのみ対応
- 将来的にスマートフォン対応を検討

**アクセシビリティ要件**:
- 文字サイズは読みやすいこと
- 色のコントラストは十分であること

---

### 5.4 デザイン方向性

**UIの雰囲気・テイスト**:
- シンプルでモダン
- ビジネス用途に適した落ち着いた印象
- 視認性が高く、長時間使用しても疲れにくい
- 不要な装飾は避ける

**カラースキーム**:
- ダークブルー系とライトグレー系の配色
- アクセントカラーは控えめに使用
- 目に優しい配色

**フォント・タイポグラフィ**:
- 日本語対応の読みやすいフォント
- 適切な文字サイズと行間
- 見出しと本文のメリハリをつける

**アイコン・ビジュアル要素**:
- 直感的に理解できるアイコン
- シンプルで統一感のあるデザイン
- 一般的に使われているアイコンを優先

---

## 6. データ要件

### 6.1 データエンティティ一覧

| エンティティID | エンティティ名 | 説明 | 想定データ量 |
|----------------|----------------|------|--------------|
| E001 | スレッド | 会話のまとまり | 100件程度 |
| E002 | メッセージ | 質問と回答のペア | スレッドあたり50件程度 |
| E003 | API設定 | APIキー情報 | 1件 |

---

### 6.2 データ項目詳細

#### E001: スレッド

**エンティティ名**: スレッド  
**説明**: 会話のまとまりを管理する単位  
**想定データ量**: 100件程度

**データ項目一覧**:
| 項目名 | データ型 | 桁数/範囲 | 必須/任意 | 初期値 | 説明 |
|--------|----------|-----------|----------|--------|------|
| スレッドID | 識別子 | - | 必須 | 自動生成 | スレッドを一意に識別 |
| スレッド名 | 文字列 | 50文字 | 必須 | "新しい会話" | ユーザー編集可能 |
| 作成日時 | 日時 | - | 必須 | 現在日時 | スレッド作成時刻 |
| 更新日時 | 日時 | - | 必須 | 現在日時 | 最終更新時刻 |

**一意制約**: スレッドID

**データの検証ルール**:
- スレッド名は1文字以上50文字以内

---

#### E002: メッセージ

**エンティティ名**: メッセージ  
**説明**: 質問と回答のペアを保持  
**想定データ量**: スレッドあたり50件程度

**データ項目一覧**:
| 項目名 | データ型 | 桁数/範囲 | 必須/任意 | 初期値 | 説明 |
|--------|----------|-----------|----------|--------|------|
| メッセージID | 識別子 | - | 必須 | 自動生成 | メッセージを一意に識別 |
| スレッドID | 識別子 | - | 必須 | - | 所属するスレッド |
| 送信者 | 文字列 | 10文字 | 必須 | - | "user"または"ai" |
| 質問内容 | 文字列 | 10,000文字 | 任意 | - | ユーザーの質問（送信者がuserの場合） |
| 統合回答 | 文字列 | 20,000文字 | 任意 | - | ChatGPTの統合回答（送信者がaiの場合） |
| ChatGPT回答 | 文字列 | 20,000文字 | 任意 | - | ChatGPT単体回答（送信者がaiの場合） |
| Perplexity回答 | 文字列 | 20,000文字 | 任意 | - | Perplexity単体回答（送信者がaiの場合） |
| 送信日時 | 日時 | - | 必須 | 現在日時 | メッセージ送信時刻 |

**一意制約**: メッセージID

**データの検証ルール**:
- 送信者は"user"または"ai"のみ
- ユーザーメッセージには質問内容が必須
- AIメッセージには統合回答、ChatGPT回答、Perplexity回答が必須

---

#### E003: API設定

**エンティティ名**: API設定  
**説明**: APIキー情報を保持  
**想定データ量**: 1件

**データ項目一覧**:
| 項目名 | データ型 | 桁数/範囲 | 必須/任意 | 初期値 | 説明 |
|--------|----------|-----------|----------|--------|------|
| ChatGPT APIキー | 文字列（保護） | 200文字 | 必須 | - | ChatGPT APIキー |
| Perplexity APIキー | 文字列（保護） | 200文字 | 必須 | - | Perplexity APIキー |

**データの検証ルール**:
- APIキーは半角英数字のみ
- APIキーは200文字以内

---

### 6.3 データ関連性

| 関連元 | 関連先 | 関連タイプ | 説明 |
|--------|--------|------------|------|
| スレッド | メッセージ | 1対多 | 1つのスレッドに複数のメッセージが紐づく |

---

### 6.4 データライフサイクル

#### スレッド
- **作成タイミング・方法**: 新規スレッドボタンをクリックした時
- **更新タイミング・トリガー**: メッセージが追加された時（更新日時を更新）
- **削除ルール**: ユーザーが明示的に削除した時（物理削除）
- **保持期間**: ユーザーが削除するまで永久保存

#### メッセージ
- **作成タイミング・方法**: 質問送信時（ユーザーメッセージ）、AI回答生成時（AIメッセージ）
- **更新タイミング・トリガー**: なし（一度作成されたら更新しない）
- **削除ルール**: 所属するスレッドが削除された時に連動して削除
- **保持期間**: 所属スレッドが削除されるまで保持

#### API設定
- **作成タイミング・方法**: 初回設定時
- **更新タイミング・トリガー**: 設定画面で変更した時
- **削除ルール**: なし（アプリをアンインストールするまで保持）
- **保持期間**: アプリをアンインストールするまで永久保持

---

### 6.5 データ永続化要件

| 項目 | 要件 |
|------|------|
| データの保存場所 | アプリケーションと同じフォルダ内、またはユーザーのドキュメントフォルダ |
| データのバックアップ要件 | ユーザー自身でフォルダごとバックアップ可能であること |
| データの同期要件 | 不要（ローカルのみで動作） |
| データの保持期間 | ユーザーが削除するまで永久保存 |

---

### 6.6 マスターデータ・初期データ

**事前に用意する必要があるデータ**: なし

**マスターデータの種類と内容**: なし

**サンプルデータの例**: なし（初回起動時はスレッドが0件の状態）

---

## 7. 処理フロー・状態遷移

### 7.1 主要処理フロー

#### AI統合回答生成処理

**処理名**: AI統合回答生成

**処理フロー**:
1. ユーザーが質問を入力して送信する
2. 質問を現在のスレッドに保存する
3. 「ChatGPTに問い合わせ中...」と表示する
4. ChatGPT APIに会話履歴を含めて問い合わせる
5. ChatGPTから回答Aを取得する
6. 「Perplexityに問い合わせ中...」と表示する
7. Perplexity APIに問い合わせる
8. Perplexityから回答Bを取得する
9. 両方の回答を取得できたか判定する
   - 取得できなかった場合：エラーメッセージを表示して終了
   - 取得できた場合：次のステップへ
10. 「回答を統合中...」と表示する
11. ChatGPTに2つの回答を分析させ統合回答Cを生成する
12. 統合回答Cを取得する
13. 3つの回答（A, B, C）をスレッドに保存する
14. 統合回答Cを画面に表示する
15. 「詳細を見る」ボタンを表示する

**正常系の流れ**:
- 上記の処理フローの1〜15をすべて実行

**異常系の流れとエラーハンドリング**:
- ChatGPTエラー時：エラーメッセージを表示して処理を中断
- Perplexityエラー時：エラーメッセージを表示して処理を中断
- タイムアウト時：エラーメッセージを表示して処理を中断

**処理時間の目安**: 15秒以内

---

### 7.2 状態遷移

#### アプリケーション全体の状態

**状態の種類**:
| 状態名 | 説明 |
|--------|------|
| 未設定 | APIキーが未設定の状態 |
| 待機中 | 質問入力待ちの状態 |
| 処理中 | AI統合回答生成中の状態 |
| 表示中 | 回答を表示している状態 |
| エラー | エラーが発生した状態 |

**状態遷移の条件・トリガー**:
- 未設定 → 待機中：APIキーを保存した時
- 待機中 → 処理中：質問を送信した時
- 処理中 → 表示中：統合回答の生成に成功した時
- 処理中 → エラー：エラーが発生した時
- エラー → 待機中：エラー確認後
- 表示中 → 待機中：次の質問入力を開始した時

**各状態で可能な操作**:
| 状態名 | 可能な操作 |
|--------|------------|
| 未設定 | APIキーの設定 |
| 待機中 | 質問入力・送信、スレッド作成・切り替え・削除、設定変更 |
| 処理中 | なし（処理完了を待つ） |
| 表示中 | 質問入力・送信、詳細表示の開閉、スレッド作成・切り替え・削除、設定変更 |
| エラー | エラー確認後、待機中に戻る |

---

## 8. 外部インターフェース仕様

### 8.1 API連携

#### ChatGPT API

**概要**: OpenAIが提供するChatGPTの公式API

**用途**: 
- 質問に対する論理的な回答の取得
- 2つの回答を分析した統合回答の生成

**必要な情報**:
- APIキー（ユーザーが設定画面で登録）

**リクエストに含める内容**:
- 質問内容
- 会話履歴（同一スレッド内の過去のやり取り）

**レスポンスの内容**:
- 回答テキスト

---

#### Perplexity API

**概要**: Perplexityが提供する最新情報検索に特化したAPI

**用途**: 
- 最新情報を含む回答の取得

**必要な情報**:
- APIキー（ユーザーが設定画面で登録）

**リクエストに含める内容**:
- 質問内容

**レスポンスの内容**:
- 回答テキスト

---

### 8.2 通信プロトコル

**使用する通信方式**: HTTPS

**通信の暗号化要件**: 必須（APIとの通信は暗号化された経路で行うこと）

---

## 9. 制約条件・前提条件

### 9.1 技術的制約

| 項目 | 制約内容 |
|------|----------|
| インターネット接続 | 必須（オフライン動作不可） |
| APIアカウント | ChatGPTとPerplexityのAPIアカウントが必要 |
| 対応OS | Windows 11以降のみ対応 |

### 9.2 リソース制約

| 項目 | 制約内容 |
|------|----------|
| 開発期間 | できるだけ早く（1〜2週間を目標） |
| 開発ツール | Google Bolt（Antigravity）またはWindsurf |
| 開発コスト | 無料ツールを使用 |

### 9.3 法的・規制上の制約

| 項目 | 制約内容 |
|------|----------|
| API利用規約 | ChatGPTとPerplexityのAPI利用規約を遵守すること |
| データ保護 | APIキーなど機密情報は適切に保護すること |

### 9.4 その他の前提条件

| 項目 | 前提内容 |
|------|----------|
| API利用料金 | ユーザー（本人）が負担 |
| APIトークン上限 | API側の契約で管理 |
| ユーザー数 | 1人（本人のみ） |

---

## 10. 用語集

| 用語 | 説明 |
|------|------|
| スレッド | 一連の会話のまとまり。ChatGPTの「Conversation」に相当 |
| 統合回答 | ChatGPTとPerplexityの回答を分析して生成された最終回答 |
| API | Application Programming Interface。外部サービスと連携するための仕組み |
| APIキー | APIを利用するための認証情報 |
| トークン | AIモデルが処理するテキストの単位。料金計算の基準 |
| レート制限 | API呼び出し回数の上限 |
| 折りたたみ表示 | 通常は非表示で、クリックすると展開して表示する方式 |

---

## 11. 参考資料・インスピレーション

### 11.1 参考にするゲーム・アプリ

| サービス名 | 参考にする点 |
|------------|--------------|
| ChatGPT | スレッド形式の会話UI、シンプルで直感的なインターフェース |
| Claude | 会話履歴の管理方法、質問と回答の表示形式 |
| Perplexity | 最新情報の表示方法 |

### 11.2 参考URL、文献

- OpenAI API公式ドキュメント
- Perplexity API公式ドキュメント

---

## 12. 基本設計への引き継ぎ事項

### 12.1 設計時に特に注意してほしいポイント

1. **処理速度の確保**
   - AI統合回答生成は15秒以内に完了すること
   - ChatGPTとPerplexityへの問い合わせを高速化すること
   
2. **エラーハンドリングの徹底**
   - どのAPIでエラーが起きたか明確にユーザーに通知すること
   - ユーザーが次に何をすべきか分かるようなメッセージにすること
   
3. **会話履歴の管理**
   - 会話の文脈を保持しつつ、APIのトークン制限を考慮すること
   - 会話履歴の送信量を適切に管理すること
   
4. **UIのシンプルさ**
   - 非エンジニアでも迷わない直感的なUIにすること
   - 操作方法を説明しなくても使えるレベルを目指すこと
   
5. **データの保護**
   - APIキーは安全に保存し、第三者が容易に取得できないようにすること

### 12.2 技術選定の制約や希望

| 項目 | 希望内容 |
|------|----------|
| 開発ツール | Google Bolt（Antigravity）またはWindsurf |
| アプリ形式 | Windowsデスクトップアプリ（.exe形式） |
| サーバー | 不要（ローカルで完結） |

### 12.3 判断を委ねる事項と判断基準

| 判断事項 | 判断基準 |
|----------|----------|
| 使用するChatGPTモデル | コストとパフォーマンスのバランス |
| データ保存形式 | 読み書きの速度と保守性のバランス |
| APIキーの保護方法 | セキュリティレベルと実装の容易性のバランス |
| ローディングアニメーション | UX向上とシステム負荷のバランス |

### 12.4 今後の検討課題・未確定事項

1. **Perplexity APIの仕様詳細**
   - 公式ドキュメントを確認し、具体的な使用方法を決定
   
2. **APIトークン上限の管理**
   - ユーザーへの通知方法や制限の扱いを検討
   
3. **将来的なClaude、Gemini連携**
   - 追加連携時の設計方針を事前に考慮
   
4. **会話履歴の送信量**
   - トークン制限を考慮した適切な送信量の決定

---

## 13. 開発フェーズの区分

### v1.0（最初のリリース）
- 本要件定義書に記載されたすべての必須機能
- Windows 11以降対応のデスクトップアプリ

### v2.0（将来検討）
- Claude、Geminiなど他のAIサービスとの連携
- Android対応（Webブラウザ）
- スレッドのエクスポート・インポート

---

## 付録：想定される使用シナリオ

### シナリオ1: 初めてアプリを使う
1. アプリを起動する
2. 設定画面が自動で開く
3. ChatGPT APIキーとPerplexity APIキーを入力する
4. 保存ボタンをクリックする
5. メイン画面が表示される
6. 質問を入力して送信する
7. 統合回答が表示される

### シナリオ2: 追加質問をする
1. メイン画面で質問を入力して送信する
2. 統合回答を確認する
3. 追加で質問を入力して送信する
4. 会話の文脈を踏まえた統合回答が表示される

### シナリオ3: 新しい話題で質問する
1. メイン画面で「新規スレッド」ボタンをクリックする
2. 新しいスレッドが作成される
3. 新しい話題の質問を入力して送信する
4. 統合回答が表示される

### シナリオ4: 過去の会話を振り返る
1. スレッド一覧から過去のスレッドをクリックする
2. 過去の会話履歴が表示される
3. 必要に応じて追加質問が可能になる

### シナリオ5: 元の回答を確認する
1. 統合回答を確認する
2. 「詳細を見る」ボタンをクリックする
3. ChatGPT単体の回答とPerplexity単体の回答が表示される
4. 2つの回答を比較・確認する

---

**要件定義書 終わり**
