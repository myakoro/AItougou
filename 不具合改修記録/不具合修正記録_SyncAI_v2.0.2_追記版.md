# 不具合修正記録_SyncAI_v2.0.2（追記版）

## 1. 本書の位置づけ
本書は、SyncAI v2.0.1 リリース後に発覚した不具合について、
**設計変更を伴わないUI実装修正および運用上の不備**として記録するものである。

要件定義書・基本設計書・詳細設計書（いずれも v2.0.1）は変更しない。
本書は、実装修正内容・運用上の原因・再発防止策を明確化し、
将来の検証・保守時の混乱を防止することを目的とする。

---

## 2. 対象バージョン

- 修正前：SyncAI v2.0.1
- 修正後：SyncAI v2.0.2（UI不具合修正・運用是正）

---

## 3. 不具合①：APIキー入力が拒否される

### 3.1 現象
設定画面において、正しい形式の ChatGPT / Perplexity APIキーを入力しても、
以下のようなエラーが表示され保存できない。

- 「半角英数字のみで入力してください」
- 「APIキーは200文字以内で入力してください」

### 3.2 影響
- 正規のAPIキーが保存できない
- 初期設定が完了せず、アプリを利用できない

### 3.3 原因
UI実装において、以下の問題が存在していた。

- 入力値の前後空白・改行を考慮しないバリデーション
- 文字種制限が設計と不一致（ハイフン・アンダースコア未許可）
- バリデーション処理およびエラー文言の出所が統一されていなかった

### 3.4 修正内容
- 入力値を trim() したうえでバリデーションを実施
- 許可文字を以下に統一
  - 半角英字（A–Z, a–z）
  - 半角数字（0–9）
  - ハイフン（-）
  - アンダースコア（_）
- 正規表現を `^[0-9A-Za-z_-]+$` に統一
- エラーメッセージをバリデーション戻り値に一本化
- UI文言「半角英数字のみ」を完全削除

---

## 4. 不具合②：修正内容が反映されない

### 4.1 現象
UIコードを修正しても、実行中のアプリでは旧挙動のままとなり、
不具合①が解消されない。

### 4.2 原因
Electron アプリが **旧ビルド成果物（dist/ フォルダ）** を参照していた。

- dist 内のビルド済み JavaScript に、
  `querying_chatgpt` 等の旧ステータス名が残存していることを確認。
- ソースコード修正後も、再ビルドを行っていなかったため、
  修正が実行環境に反映されていなかった。

### 4.3 対処
- dist フォルダを削除
- `npm run build` を再実行
- 再ビルド後の成果物でアプリを起動し、正常動作を確認

---

## 5. 影響範囲

| 項目 | 影響 |
|---|---|
| 要件定義書 | なし |
| 基本設計書 | なし |
| 詳細設計書 | なし |
| UI実装 | あり（入力バリデーション・ビルド反映） |
| ロジック実装 | なし |
| データ構造 | なし |

---

## 6. 再発防止策（固定ルール）

### 6.1 開発環境テスト前の必須手順
UIまたはロジック修正後、開発環境での確認前に以下を必ず実施する。

1. 既存のビルド成果物（dist/）を削除する
2. `npm run build` を実行する
3. 再ビルド後のアプリで動作確認を行う

※ 本手順を省略してはならない。

---

## 7. 確認観点（受け入れチェック）

1. APIキーに `-` および `_` を含む文字列が保存できること
2. APIキー前後に空白・改行があっても保存できること
3. UIに旧文言（「半角英数字のみ」等）が表示されないこと
4. dist 内に旧ステータス名が含まれていないこと
5. 再起動後も設定が保持されていること

---

## 8. 補足

本修正は、設計変更を伴わない UI実装および運用是正であり、
要件・設計の見直しや仕様追加を意図するものではない。

以上。
