# 基本設計書_SyncAI_v2.0.1

## 1. 本書の位置づけ
本書は「要件定義書_SyncAI_v2.0」を正とし、
SyncAI アプリケーションの基本設計を定義する。
本設計は v1.0 実装との互換性を維持することを前提とし、
実装者（Windsurf / Antigravity）が判断を行わずに実装できる状態を作ることを目的とする。

---

## 2. 前提条件（固定）

- 要件定義 v2.0 を一切変更しない
- v1.0 実装との互換性を維持する
- UI技術は Electron + React に固定する
- UI文言はすべて日本語とする
- スレッド削除は論理削除とする
- 外部AI失敗時はフェイルソフトとする
- v1.0 データ移行は行わない（2.0は初期化）

---

## 3. システム構成

- Desktop Framework：Electron
- UI：React
- 状態管理：React State（詳細設計に委譲）
- 永続化：SQLite
- 設定ファイル：JSON

---

## 4. データ設計

### 4.1 threads テーブル

| カラム名 | 型 | 説明 |
|---|---|---|
| id | TEXT | スレッドID |
| title | TEXT | スレッドタイトル |
| created_at | TEXT | 作成日時 |
| is_deleted | INTEGER | 論理削除フラグ（0/1） |
| deleted_at | TEXT | 削除日時（NULL可） |

### 4.2 messages テーブル

| カラム名 | 型 | 説明 |
|---|---|---|
| id | TEXT | メッセージID |
| thread_id | TEXT | スレッドID |
| role | TEXT | user / assistant |
| content | TEXT | 表示内容 |
| question_type | TEXT | TYPE_A / TYPE_B |
| check_items | TEXT | 判定観点 |
| perplexity_result | TEXT | 調査結果(JSON) |
| created_at | TEXT | 作成日時 |

---

## 5. スレッド削除仕様（固定）

- スレッド削除は論理削除とする
- threads レコードは物理削除しない
- 削除時に is_deleted=1, deleted_at=現在時刻 を設定する
- is_deleted=1 のスレッドは一覧・参照対象外とする
- 復元機能は提供しない

### UI文言
- 成功：「スレッドを削除しました」
- 参照不可：「スレッドが見つかりません」

---

## 6. 質問分類・AI呼び出しフロー

### 6.1 質問分類
- 入力内容を TYPE_A / TYPE_B に分類する

### 6.2 TYPE_A
- ChatGPT のみ呼び出す

### 6.3 TYPE_B
- ChatGPT による回答生成
- Perplexity による調査を実施
- 調査結果には情報源URLを必ず含める

---

## 7. フェイルソフト仕様（固定）

| ChatGPT | Perplexity | 表示内容 | 通知 |
|---|---|---|---|
| 成功 | 成功 | 最終回答 | なし |
| 成功 | 失敗 | ChatGPT回答 | 調査に失敗したため、回答のみ表示しました |
| 失敗 | 成功 | 調査結果 | 回答の生成に失敗したため、調査結果を表示しました |
| 失敗 | 失敗 | 表示なし | 処理に失敗しました。時間をおいて再度お試しください |

---

## 8. モデル管理

- 起動時に GitHub から models.json を取得する
- タイムアウト：5秒
- 失敗時はローカル models.json を使用する
- ユーザーへのエラー通知は行わない

---

## 9. データ移行方針

- v1.0 データの移行は行わない
- 初回起動時のスレッド一覧は空とする

---

## 10. 実装上の禁止事項

- UI文言を英語で表示すること
- 物理削除を実装すること
- 技術スタックを変更すること
- 要件・設計を解釈・補完すること

---

## 11. 本設計の完了条件

- 本書記載内容がすべて実装されていること
- 実装者の判断が不要であること
- v1.0 契約との矛盾が存在しないこと
